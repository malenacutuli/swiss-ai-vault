apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: swissbrain
  labels:
    app: swissbrain
    environment: production
data:
  # Environment
  NODE_ENV: "production"
  ENVIRONMENT: "production"
  LOG_LEVEL: "warn"
  DEBUG: "false"

  # Application
  APP_NAME: "SwissBrain AI"
  APP_VERSION: "1.0.0"
  APP_URL: "https://swissbrain.ai"
  API_URL: "https://api.swissbrain.ai"

  # Feature Flags
  ENABLE_ANALYTICS: "true"
  ENABLE_ERROR_TRACKING: "true"
  ENABLE_RATE_LIMITING: "true"
  ENABLE_CACHING: "true"
  ENABLE_DEBUG_MODE: "false"

  # Redis Configuration
  REDIS_HOST: "redis.swissbrain.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  REDIS_TLS_ENABLED: "false"
  REDIS_MAX_RETRIES: "3"
  REDIS_RETRY_STRATEGY: "exponential"

  # Database
  DB_SSL_MODE: "require"
  DB_POOL_MIN: "10"
  DB_POOL_MAX: "50"
  DB_IDLE_TIMEOUT: "60000"
  DB_CONNECTION_TIMEOUT: "15000"
  DB_STATEMENT_TIMEOUT: "30000"

  # API Configuration
  API_RATE_LIMIT_WINDOW: "60000"
  API_RATE_LIMIT_MAX_REQUESTS: "200"
  API_TIMEOUT: "60000"
  API_MAX_PAYLOAD_SIZE: "100mb"
  API_COMPRESSION_ENABLED: "true"

  # Job Queue
  QUEUE_CONCURRENCY: "20"
  QUEUE_MAX_RETRIES: "5"
  QUEUE_RETRY_DELAY: "2000"
  QUEUE_JOB_TIMEOUT: "900000"  # 15 minutes
  QUEUE_STALLED_INTERVAL: "30000"
  QUEUE_LOCK_DURATION: "30000"

  # File Upload
  MAX_FILE_SIZE: "104857600"  # 100MB
  ALLOWED_FILE_TYPES: "pdf,doc,docx,txt,md,jpg,jpeg,png,gif,webp,svg,ppt,pptx,xls,xlsx"
  UPLOAD_TEMP_DIR: "/tmp/uploads"
  UPLOAD_VIRUS_SCAN_ENABLED: "true"

  # Agent Configuration
  AGENT_MAX_EXECUTION_TIME: "900000"  # 15 minutes
  AGENT_MAX_MEMORY: "8192"  # 8GB
  AGENT_SANDBOX_ENABLED: "true"
  AGENT_NETWORK_ISOLATION: "true"
  AGENT_RESOURCE_LIMITS_ENFORCED: "true"

  # Cache Configuration
  CACHE_TTL: "3600"  # 1 hour
  CACHE_MAX_SIZE: "10000"
  CACHE_STRATEGY: "lru"

  # CORS Configuration
  CORS_ENABLED: "true"
  CORS_ORIGIN: "https://swissbrain.ai,https://app.swissbrain.ai"
  CORS_METHODS: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  CORS_CREDENTIALS: "true"
  CORS_MAX_AGE: "86400"

  # Session Configuration
  SESSION_SECRET_ROTATION: "true"
  SESSION_MAX_AGE: "2592000000"  # 30 days
  SESSION_SECURE: "true"  # HTTPS only
  SESSION_SAME_SITE: "strict"
  SESSION_HTTP_ONLY: "true"

  # Logging
  LOG_FORMAT: "json"
  LOG_COLORIZE: "false"
  LOG_INCLUDE_TIMESTAMP: "true"
  LOG_SAMPLE_RATE: "0.1"  # Sample 10% of logs

  # Monitoring
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  HEALTH_CHECK_PATH: "/health"
  METRICS_COLLECT_DEFAULT: "true"

  # Performance
  HOT_RELOAD_ENABLED: "false"
  SOURCE_MAPS_ENABLED: "false"  # Disabled for performance
  PROFILING_ENABLED: "false"
  CLUSTER_MODE_ENABLED: "true"
  WORKER_THREADS: "4"

  # Timeouts
  HTTP_TIMEOUT: "60000"
  WS_TIMEOUT: "120000"
  GRACEFUL_SHUTDOWN_TIMEOUT: "30000"
  KEEP_ALIVE_TIMEOUT: "65000"

  # Security
  HELMET_ENABLED: "true"
  RATE_LIMIT_ENABLED: "true"
  CSRF_ENABLED: "true"
  HSTS_ENABLED: "true"
  HSTS_MAX_AGE: "31536000"
  CONTENT_SECURITY_POLICY_ENABLED: "true"

  # SSL/TLS
  TLS_MIN_VERSION: "1.2"
  TLS_CIPHERS: "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384"

  # Backups
  BACKUP_ENABLED: "true"
  BACKUP_SCHEDULE: "0 2 * * *"  # Daily at 2 AM
  BACKUP_RETENTION_DAYS: "30"

  # Data Residency (Swiss Compliance)
  DATA_REGION: "ch-gva-2"
  DATA_RESIDENCY_ENFORCED: "true"
  GDPR_COMPLIANCE_MODE: "true"

  # Audit Logging
  AUDIT_LOG_ENABLED: "true"
  AUDIT_LOG_RETENTION_DAYS: "90"
  AUDIT_LOG_SENSITIVE_DATA_MASKING: "true"

  # Error Handling
  ERROR_PAGES_ENABLED: "true"
  ERROR_STACK_TRACE_VISIBLE: "false"
  ERROR_DETAILED_MESSAGES: "false"
